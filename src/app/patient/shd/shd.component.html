<div class="m-content">
  <div class="m-portlet m-portlet--mobile">
    <div class="m-portlet__head">
      <div class="m-portlet__head-caption">
        <div class="m-portlet__head-title">
          <h3 class="m-portlet__head-text"> Khawaja Mujtaba
            <small class="pad_15">
              <a class="m-link" href="#"> Edit </a>
              <a class="m-link pad_8" href="#"> Contact Info </a>
            </small>
            <br>
            <small> Male 16 Year(s) (02-Sep-2001) </small>
          </h3>
        </div>
      </div>
      <div class="m-portlet__head-tools">
        <ul class="nav nav-pills nav-pills--brand m-nav-pills--align-right m-nav-pills--btn-pill m-nav-pills--btn-sm" role="tablist">
          <li class="nav-item m-tabs__item">
            <a class="nav-link m-tabs__link" data-toggle="tab" href="#m_widget2_tab2_content1" role="tab"> Patient Id </a>
          </li>
          <li class="nav-item m-tabs__item">
            <a class="nav-link m-tabs__link active" data-toggle="tab" href="#m_widget2_tab1_content" role="tab"> 548HTU </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <div class="m-portlet">
        <div class="m-portlet__head">
          <div class="m-portlet__head-caption">
            <div class="m-portlet__head-title">
              <span class="m-portlet__head-icon m--hide">
                <i class="la la-gear"></i>
              </span>
              <h3 class="m-portlet__head-text">Daily Appointments </h3>
            </div>
          </div>
        </div>

        <div class="m-portlet__body">
          <ul class="nav nav-pills" role="tablist">
            <li class="nav-item">
              <a class="nav-link active show" data-toggle="tab" href="#m_tabs_3_1">
                Tentative Appointment
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#m_tabs_3_3">
                Final Appointment
              </a>
            </li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane active show" id="m_tabs_3_1" role="tabpanel">
              <form class="m-form m-form--fit m-form--label-align-right ng-untouched ng-pristine ng-invalid" [formGroup]="appointmentForm">
                <div class="m-portlet__body">
                  <div class="form-group row">
                    <div class="form-group col-lg-4">
                      <label for="exampleSelect1"> Consultant </label>
                      <select #cid class="form-control m-input ng-pristine ng-invalid ng-touched" formControlName="ConsultantId">
                        <option  class="active" *ngFor="let consultant of PatientServiceobj?.consultant" [value]="consultant.consultantId">{{consultant.name}}</option>
                      </select>
                    </div>
                    <div class="form-group col-lg-4">
                      <button class="btn btn-default pull-right blankinput" type="button" (click)="addFieldValue()">Add Row</button>
                    </div>
                    <div class="form-group  col-lg-4 ">
                      <button type="button" class="btn btn-primary blankinput pull-right" data-toggle="modal" data-target="#m_modal_1">
                        Send SMS +
                      </button>
                    </div>
                  </div>
                  <div *ngIf="showAddNewPatientRow">
                    <div class="form-group row">
                      <div class="form-group col-lg-4">
                        <label for="exampleInputEmail1">
                          Patient Type
                        </label>
                        <select (change)="selectNewOrPrevious($event)" class="form-control m-input m-input--solid" formControlName="PatientType">
                          <option value="new">New</option>
                          <option value="pervious"> Pervious</option>
                        </select>
                      </div>
                      <div class="form-group col-lg-4">
                        <label for="exampleSelect1"> </label>
                        Patients
                        <select class="form-control m-input ng-pristine ng-invalid ng-touched" formControlName="PatientId" *ngIf="newOrPrevious === 'new'? false : true">
                          <option class="active" *ngFor="let patient of PatientServiceobj?.patients" [value]="patient.patientId">{{patient.mrn}}</option>
                        </select>
                        <!-- [value]="patientForm.FirstName + ' ' +patientForm.LastName"  [value]="patientForm.value.PhoneNumber"  -->
                        <input [value]="patientForm.value.PhoneNumber" *ngIf="newOrPrevious === 'new'? true : false" class="form-control m-input m-input--solid"
                          formControlName="PatientId" disabled>
                      </div>
                      <div class="form-group col-lg-4">
                        <label for="exampleInputEmail1"> Visit Status </label>
                        <input class="form-control m-input m-input--solid" formControlName="VisitStatus">
                      </div>

                    </div>
                    <div class="form-group row">
                      <div class="form-group col-lg-4">
                        <label for="exampleInputEmail1"> Visit Nature </label>
                        <input class="form-control m-input m-input--solid" formControlName="VisitNature">
                      </div>
                      <div class="form-group col-lg-4">
                        <label for="exampleInputEmail1"> Time </label>
                        <input class="form-control m-input m-input--solid" formControlName="FinalTime" type="time">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="form-group col-lg-12">
                        <button type="submit" (click)="deleteFieldValue()" class="btn btn-primary">
                          Cancle
                        </button> |
                        <button type="submit" (click)="addApointment(appointmentForm.value , cid)" class="btn btn-primary">
                          Submit
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div>

                </div>
              </form>
              <dx-data-grid id="gridContainer" [dataSource]="PatientServiceobj.appointment" (onRowUpdated)="updateAppointment($event)"
                (onRowRemoved)="deleteAppointment($event)">
                <dxo-editing mode="row" [allowUpdating]="true" [allowDeleting]="true" [useIcons]="true">
                </dxo-editing>
                <dxo-filter-row [visible]="true"></dxo-filter-row>
                <dxo-header-filter [visible]="true"></dxo-header-filter>
                <dxo-paging [pageSize]="5"></dxo-paging>
                <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[3, 5, 300]" [showInfo]="true"></dxo-pager>
                <dxi-column dataField="appointmentId" caption="Id"></dxi-column>
                <dxi-column dataField="patientType" caption="Type"></dxi-column>
                <dxi-column dataField="patientId" caption="MRN #" [width]="125">
                  <dxo-lookup [dataSource]="par" displayExpr="mrn" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="patientId" caption="Patients" [width]="125">
                  <dxo-lookup [dataSource]="par" displayExpr="lastName" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="patientId" caption="No" [width]="125">
                  <dxo-lookup [dataSource]="par" displayExpr="phoneNumber" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="patientId" caption="Alternet No" [width]="125">
                  <dxo-lookup [dataSource]="par" displayExpr="officeTel" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="finalTime" caption="Time"></dxi-column>
                <dxi-column dataField="visitStatus" caption="Status"></dxi-column>
              </dx-data-grid>
            </div>


            <!-- <here we are using final appointment tag start work> -->
            <div class="tab-pane" id="m_tabs_3_3" role="tabpanel">
              <dx-data-grid id="gridContiner" [dataSource]="PatientServiceobj.appointment" (onRowUpdated)="updateAppointment($event)" (onRowRemoved)="deleteAppointment($event)">
                <dxo-editing mode="popup" [allowUpdating]="true" [allowDeleting]="true" [useIcons]="true">
                  <dxo-popup title="Patient Type" [showTitle]="true" [width]="750" [height]="345" [position]="{ my: 'center', at: 'center', of: window }"></dxo-popup>
                </dxo-editing>
                <dxo-selection mode="single"></dxo-selection>

                <dxo-filter-row [visible]="true"></dxo-filter-row>
                <dxo-header-filter [visible]="true"></dxo-header-filter>
                <dxo-paging [pageSize]="5"></dxo-paging>
                <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[3, 5, 30]" [showInfo]="true"></dxo-pager>
                <dxi-column dataField="appointmentId" caption="Id" [allowEditing]="false" [formItem]="{visible: false}"></dxi-column>
                <dxi-column dataField="patientType" caption="Type" [allowEditing]="false" [formItem]="{visible: false}"></dxi-column>
                <dxi-column dataField="patientId" caption="MRN #" [width]="125" [allowEditing]="false" [formItem]="{visible: false}">
                  <dxo-lookup [dataSource]="par" displayExpr="mrn" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="patientId" caption="Patients" [width]="125" [allowEditing]="false" [formItem]="{visible: false}">
                  <dxo-lookup [dataSource]="par" displayExpr="lastName" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="patientId" caption="No" [width]="125" [allowEditing]="false" [formItem]="{visible: false}">
                  <dxo-lookup [dataSource]="par" displayExpr="phoneNumber" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="patientId" caption="Alternet No" [width]="125" [allowEditing]="false" [formItem]="{visible: false}">
                  <dxo-lookup [dataSource]="par" displayExpr="officeTel" valueExpr="patientId"></dxo-lookup>
                </dxi-column>
                <dxi-column dataField="finalTime" caption="Time" [allowEditing]="false" [formItem]="{visible: false}"></dxi-column>
                <dxi-column dataField="visitStatus" caption="Status" [allowEditing]="false" [formItem]="{visible: false}"></dxi-column>
                <dxi-column dataField="visitNature" caption="Nature" [allowEditing]="false" [formItem]="{visible: false}"></dxi-column>
                <dxi-column dataField="timeIn" caption="Time In" [visible]="false" type="time"></dxi-column>
                <dxi-column dataField="timeOut" caption="Time Out" [visible]="false" dataType="Time"></dxi-column>
                <dxi-column dataField="remarks" caption="Remarks" [visible]="false"></dxi-column>
                <!-- <dxi-column dataField="patientType" [allowEditing]="false"  [formItem]="{visible: false}" caption="Patient Type"></dxi-column>
                  <dxi-column dataField="finalTime"  caption="Final Time" [allowEditing]="false"  [formItem]="{visible: false}"></dxi-column>
                  <dxi-column dataField="visitStatus" caption="Visit Status" [allowEditing]="false"  [formItem]="{visible: false}"></dxi-column>
                  <dxi-column dataField="visitNature" caption="Visit Nature" [allowEditing]="false"  [formItem]="{visible: false}"></dxi-column>
                  <dxi-column dataField="timeIn" caption="Time In"  [visible]="false"  dataType="time"></dxi-column>
                  <dxi-column dataField="timeOut" caption="Time Out" [visible]="false" dataType="Time"></dxi-column>
                  <dxi-column dataField="remarks" caption="Remarks"   [visible]="false"></dxi-column>   -->
                <dxi-column caption="Add Test" cellTemplate="chartCellTemplate" [allowEditing]="false" [formItem]="{visible: false}"></dxi-column>
                <div *dxTemplate="let d of 'chartCellTemplate'">
                  <div class="chart-cell">
                    <!-- (click)="appointTime(value)"   -->
                    <dx-button (click)="getCurrentRowData(d)" data-toggle="modal" data-target="#m_modal_3" icon="user"></dx-button>
                    <!-- <dx-button data-toggle="modal" data-target="#m_modal_3" icon="edit"></dx-button> -->
                  </div>
                </div>

              </dx-data-grid>
            </div>
            <!-- <here we are using final appointment tag end work> -->
          </div>
        </div>
      </div>
    </div>
  </div>

</div>


<div #popup class="popup modal" [style.display]="newOrPrevious === 'new' ? 'flex' : 'none'" (click)="hidePopup($event, popup)">
  <div class="form">
    <div class="" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <i class="m-nav__link-icon flaticon-share"></i>
          <span class="m-nav__link-text">
            Add New Patient
          </span>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">
              ×
            </span>
          </button>
        </div>
        <div class="modal-body">
          <!-- <form [formGroup]="profileForm">

            <label>
              First Name:
              <input type="text" formControlName="firstName">
            </label>
          
            <label>
              Last Name:
              <input type="text" formControlName="lastName">
            </label>
            <button (click)="showIt()">Show</button>
          </form> -->
          <form class="m-form m-form--label-align-left- m-form--state-" id="m_form" [formGroup]="patientForm"> -->
            <!-- <input type="text" [formControl]="FirstName"> 
             -->
         <div class="m-portlet__body">
              <div class="form-group row">
                <div class="form-group col-lg-4">
                  <label for="exampleInputEmail1"> First Name </label>
                  <input formControlName="FirstName" class="form-control m-input m-input--solid ng-untouched ng-pristine ng-invalid">
                </div>
                <div class="form-group col-lg-4">
                  <label for="exampleInputEmail1"> LastName </label>
                  <input formControlName="LastName" class="form-control m-input m-input--solid ng-untouched ng-pristine ng-invalid">
                </div>
                <div class="form-group col-lg-4">
                  <label for="exampleSelect1"> Gender </label>
                  <select formControlName="Gender" class="form-control m-input ng-pristine ng-valid ng-touched">
                    <option class="active" value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <div class="form-group col-lg-4">
                  <label for="exampleInputEmail1"> Date Of Birth </label>
                  <input formControlName="DOB" class="form-control m-input m-input--solid ng-untouched ng-pristine ng-invalid" type="date">
                </div>
                <div class="form-group col-lg-4">
                  <label for="exampleInputEmail1"> CNIC </label>
                  <input formControlName="NIC" class="form-control m-input m-input--solid ng-untouched ng-pristine ng-invalid">
                </div>
                <div class="form-group col-lg-4">
                  <label for="exampleInputEmail1"> PhoneNumber </label>
                  <input formControlName="PhoneNumber" class="form-control m-input m-input--solid ng-untouched ng-pristine ng-invalid">
                </div>

              </div>
              <div class="form-group row">
                <div class="form-group col-lg-12">
                  <div class="form-action pull-right">
                    <button type="submit" (click)="onAddPatient(patientForm.value)" class="btn btn-focus m-btn m-btn--pill m-btn--custom m-btn--air">
                      Submit
                    </button>
                  </div>
                </div>
              </div>
            </div> 
          </form>
        </div>
      </div>
    </div>
  </div>
  <div id="popup" class="overlay"></div>
</div>


<!-- strat model for send sms -->
<div class="modal fade" id="m_modal_1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <i class="m-nav__link-icon flaticon-share"></i>
        <span class="m-nav__link-text">
          Send SMS
        </span>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">
            ×
          </span>
        </button>
      </div>
      <div class="modal-body">
        <form class="m-form m-form--fit m-form--label-align-right">
          <div class="m-portlet__body">
            <div class="form-group row">
              <div class="form-group col-lg-12">
                <label for="exampleSelect1"> Consultant </label>
              </div>

            </div>
            <div class="form-group row">
              <div class="form-group col-lg-4">
                <label class="m-radio">
                  <input type="radio" name="example_3" value="1"> Cancelled
                  <span></span>
                </label>
              </div>
              <div class="form-group col-lg-4">
                <label class="m-radio">
                  <input type="radio" name="example_3" value="1"> Done
                  <span></span>
                </label>
              </div>
              <div class="form-group col-lg-4">
                <label class="m-radio">
                  <input type="radio" name="example_3" value="1"> Reschedule
                  <span></span>
                </label>
              </div>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary">
              Send SMS
            </button>
            <button type="button" data-dismiss="modal" class="btn btn-secondary">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- end model for send sms -->

<!-- start visit detail -->
<!-- <div class="modal fade" id="m_modal_2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <i class="m-nav__link-icon flaticon-share"></i>
          <span class="m-nav__link-text">
            Visit Detail
          </span>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">
              ×
            </span>
          </button>
        </div>
        <div class="modal-body">
          <form class="m-form m-form--fit m-form--label-align-right" [formGroup]="appointmentTimeForm">
            <div class="m-portlet__body">
              <div class="form-group row">
                <div class="form-group col-lg-6">
                  <label for="exampleInputEmail1"> Time In </label>
                  <div class="input-group date">
                    <input class="form-control m-input" formControlName="TimeIn" type="date" >
                  </div>
                </div>
                <div class="form-group col-lg-6">
                  <label for="exampleInputEmail1"> Time Out </label>
                  <div class="input-group date">
                    <input class="form-control m-input" formControlName="TimeOut" type="date">
                  </div>
                </div>
              </div>
  
              <div class="form-group row">
                <div class="form-group col-lg-12">
                  <label for="exampleTextarea">
                    Remarks
                  </label>
                  <textarea class="form-control m-input" id="exampleTextarea" rows="3" formControlName="Remarks" ></textarea>
                </div>
              </div>
  
            </div>
            <div class="modal-footer">
              <button type="button" (click)="appointTimeSet(appointmentTimeForm.value)" class="btn btn-primary">
                Submit
              </button>
              <button type="button" data-dismiss="modal" class="btn btn-secondary">
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div> -->
<!-- end visit detail -->

<!-- start add visit -->
<div class="modal fade" id="m_modal_3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <i class="m-nav__link-icon flaticon-share"></i>
        <span class="m-nav__link-text">
          Add Test
        </span>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">
            ×
          </span>
        </button>
      </div>
      <div class="modal-body">
        <form class="m-form m-form--fit m-form--label-align-right" [formGroup]="appointmenttestForm">
          <div class="m-portlet__body">
            <div class="form-group row">
              <div class="form-group col-lg-10">
                <label for="exampleSelect1"> Test </label>
                <select class="form-control m-input ng-pristine ng-invalid ng-touched" formControlName="TestId">
                  <option class="active" *ngFor="let test of PatientServiceobj?.testing" [value]="test.testId">{{test.testName}}</option>
                </select>

                <!-- <label for="exampleInputEmail1">Test Name:</label> -->
                <input #id class="form-control m-input m-input--solid ng-untouched ng-pristine ng-invalid hide" [value]="currentpatient?.appointmentId"
                  formControlName="AppointmentId" type="text">
              </div>
              <div class="form-group col-lg-2">
                <button type="button" (click)="addrange(id)" class="btn btn-info blankinput">
                  +
                </button>
              </div>
            </div>
            <div class="m-section">
              <div class="m-section__content">
                <table class="table m-table m-table--head-separator-primary">
                  <thead>
                    <tr>
                      <th>
                        Test Name
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor=" let t of Tests; let i = index">
                      <td>{{t.TestId}}</td>
                      <td>
                        <button type="button" (click)="remove(i)" class="btn btn-primary">
                          <i class="la la-archive"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>

                <dx-data-grid id="gridContainer" [dataSource]="getaptbyid?.appointmentTests"> 
                    <dxo-load-panel
                    [enabled]="true">
                </dxo-load-panel>
                    <dxo-editing mode="row">
                </dxo-editing>
                  <dxo-filter-row [visible]="true"></dxo-filter-row>
                  <dxo-header-filter [visible]="true"></dxo-header-filter>
                  <dxo-paging [pageSize]="3"></dxo-paging>
                  <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[3, 5, 30]" [showInfo]="true"></dxo-pager>

                  <!-- <dxi-column dataField="appointmentId" caption="patient Type" [allowEditing]="false" [formItem]="{visible: false}">
                      <dxo-lookup [dataSource]="appointment" displayExpr="patientType" valueExpr="appointmentId"></dxo-lookup>
                    </dxi-column> -->
                  <!-- <dxi-column dataField="patientId" caption="Patients" [allowEditing]="false" [formItem]="{visible: false}">
                    <dxo-lookup [dataSource]="par" displayExpr="lastName" valueExpr="patientId"></dxo-lookup>
                  </dxi-column> -->
                  <dxi-column dataField="testId" caption="Test Code" [allowEditing]="false" [formItem]="{visible: false}">
                      <dxo-lookup [dataSource]="test" displayExpr="testCode" valueExpr="testId"></dxo-lookup>
                  </dxi-column>
                  <dxi-column dataField="testId" caption="Test Name" [allowEditing]="false" [formItem]="{visible: false}">
                      <dxo-lookup [dataSource]="test" displayExpr="testName" valueExpr="testId"></dxo-lookup>
                  </dxi-column>
                  <!-- <dxi-column dataField="testId" caption="Test Id"></dxi-column> -->
                </dx-data-grid>

              </div>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" (click)="addappointmentTest(Tests)" class="btn btn-primary">
              Submit
            </button>
            <button type="button" data-dismiss="modal" class="btn btn-secondary">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- end add visit -->