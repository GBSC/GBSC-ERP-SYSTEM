<div class="m-subheader-search">
  <div class="col-sm-12">
    <div class="row">
      <div class="col-sm-6">
        <h2 class="m-subheader-search__title" style="text-align: left;">
          Sales Person Journey
          <span class="m-subheader-search__desc">
            Report
          </span>
        </h2>
      </div>
      <div class="col-sm-6">
        <button (click)="toggleFilter()" style="float: right; border: solid 1px;" class="btn btn-outline-metal m-btn m-btn--icon m-btn--pill">
          <span *ngIf="showHideFilter">
            <i class="la la-close"></i>
            <span>
              Hide
            </span>
          </span>

          <span *ngIf="!showHideFilter">
            <i class="la la-sort"></i>
            <span>
              Show Filters
            </span>
          </span>
        </button>
      </div>
    </div>
  </div>
  <div *ngIf="showHideFilter" class="m-grid m-grid--ver-desktop m-grid--desktop">

    <div class="col-sm-12">
      <hr style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
      <div class="row">
        <div class="col-sm-2">
          <div class="form-group m-form__group">
            <label>
              Region
            </label>
            <select [disabled]="DisableRegion" #Region class="form-control m-input" (change)="onRegionChange(Region.value)">
              <option class='option' disabled selected>Select Region</option>
              <option class='option' *ngFor="let region of Regions" [value]="regionId || region?.regionId">{{region?.name}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="m-form__group form-group">
            <label>
              City
            </label>
            <select [disabled]="DisableCity" #City class="form-control m-input" (change)="onCityChange(City.value)">
              <option class='option' disabled selected>Select City</option>
              <option class='option' *ngFor="let city of Cities" [value]="cityId || city?.cityId">{{city?.name}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="m-form__group form-group">
            <label>
              Area
            </label>
            <select [disabled]="DisableArea" #Area class="form-control m-input" (change)="onAreaChange(Area.value)">
              <option class='option' disabled selected>Select Area</option>
              <option class='option' *ngFor="let area of Areas" [value]="areaId || area?.areaId">{{area?.name}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="form-group m-form__group">
            <label>
              Distributor
            </label>
            <select [disabled]="DistributorDisable" #Distributor class="form-control m-input" (change)="onDistributorChange(Distributor.value)">
              <option class='option' disabled selected>Select Distributor</option>
              <option class='option' *ngFor="let distributor of Distributors" [value]="distributorId || distributor?.distributorId">{{distributor?.name}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="form-group m-form__group">
            <label>
              Territory
            </label>
            <select [disabled]="TerritoryDisable" #Territory class="form-control m-input" (change)="onTerritoryChange(Territory.value)">
              <option class='option' disabled selected>Select Region</option>
              <option class='option' *ngFor="let territory of Territories" [value]="territoryId || territory?.territoryId">{{territory?.name}}</option>
            </select> </div>
        </div>
        <div class="col-sm-2">
          <div class="form-group m-form__group">
            <label>
              Section
            </label>
            <select [disabled]="SectionDisable" #Section class="form-control m-input" (change)="onSectionChange(Section.value)">
              <option class='option' disabled selected>Select Section</option>
              <option class='option' *ngFor="let section of Sections" [value]="sectionId || section?.sectionId">{{section?.name}}</option>
            </select>
          </div>
        </div>
      </div>
      <div class="row">



        <div class="col-sm-2">
          <div class="m-form__group form-group">
            <label>
              Sub Section
            </label>
            <select [disabled]="SubsectionDisable" #SubSection class="form-control m-input" (change)="onSubsectionChange(SubSection.value)">
              <option class='option' disabled selected>Select Subsection</option>
              <option class='option' *ngFor="let subsection of Subsections" [value]="subsectionId || subsection?.subsectionId">{{subsection?.name}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="form-group m-form__group">
            <label>
              Select User
            </label>
            <select [disabled]="DsfDisable" #DSF class="form-control m-input" (change)="selectUser(DSF.value)">
              <option class='option' disabled selected>Select DSF</option>
              <option class='option' *ngFor="let dsf of DSFs" [value]="dsf?.userId">{{dsf?.firstName}}
                {{dsf?.lastName}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="form-group m-form__group">
            <label>
              From
            </label>
            <input class="form-control m-input" type="date" (change)="filterFromDate($event)">
          </div>
        </div>
        <div class="col-sm-2">
          <div class="form-group m-form__group">
            <label>
              To
            </label>
            <input class="form-control m-input" type="date" (change)="filterToDate($event)"> </div>
        </div>
      </div>

      <div class="row">



        <div class="col-sm-3">
          <div class="form-group m-form__group">
            <label>
              Set Zoom
            </label>
            <input [value]="agmMap?.zoom" type="range" min="0" max="22" step="1" (change)="selectZoomLevel($event)">
            <span>Current Zoom Level {{agmMap?.zoom}}</span>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="m-form__group form-group">
            <label>
              Shops
            </label>
            <div class="m-checkbox-list">
              <button (click)="showVisitedShops($event)">Fetch Visited Shops</button>
            </div>
          </div>
        </div>

        <div class="col-sm-1">
          <button (click)="go($event)" class="btn btn-success">
            Search
          </button>
        </div>

      </div>

    </div>
  </div>

</div>

<div class="m-subheader-search">
  <!-- <h2 class="m-subheader-search__title">
              Locater
                <span class="m-subheader-search__desc">
                  Tracking System
                </span>
            </h2> -->

<<<<<<< HEAD
                <div class="m-grid m-grid--ver-desktop m-grid--desktop">
                    <div class="col-sm-12" >
                        <div class="row">
                          <div class="col-sm-3">
                              <div class="form-group m-form__group">
                                  <label>
                                      Select User
                                  </label>
                                  <select class="form-control m-input" name="" id="" (change)="selectUser($event)">
                                      <option [selected]="user.userid == eTrackerUserService.currentUser.userid" *ngFor="let user of eTrackerUserService.allUsers; let i = index" [value]="user?.userid">{{user.userid}}</option>
                                    </select>
                                </div>
                          </div>
                          <div class="col-sm-2">
                              <div class="form-group m-form__group">
                                  <label>
                                      From
                                  </label>
                                  <input class="form-control m-input" type="date" (change)="filterFromDate($event)">
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <div class="form-group m-form__group">
                                    <label>
                                        To
                                    </label>
                                    <input class="form-control m-input" type="date" (change)="filterToDate($event)">                                  </div>
                              </div>
                             
                                <div class="col-sm-2">
                                    <div class="form-group m-form__group">
                                        <label>
                                            Set Zoom
                                        </label>
                                        <input [value]="agmMap?.zoom" type="range" min="0" max="22" step="1" (change)="selectZoomLevel($event)">
<span>Current Zoom Level {{agmMap?.zoom}}</span>
                                      </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="m-form__group form-group">
                                        <label>
                                          Shops
                                        </label>
                                        <div class="m-checkbox-list">
                                          <button (click)="showVisitedShops($event)">Fetch Visited Shops</button>
                                        </div>
                                      </div>
                                  </div>
                                
                                <div class="col-sm-1">
                                    <button (click)="go()" class="btn btn-success">
                                        Search
                                      </button>
                                </div>

                        </div>
                       
                    </div>
                    <div class="m-grid__item m-grid__item--middle">
                        <div class="m--margin-top-20 m--visible-tablet-and-mobile"></div>
                        <p *ngIf="eTrackerUserService?.showSpinner">loading...</p>
                        <!-- <img *ngIf="eTrackerUserService?.showSpinner" src="/assets/images/spinner.gif" /> -->
                        
                       
                    </div>
          
          
                </div>
=======
  <div class="m-grid m-grid--ver-desktop m-grid--desktop">
>>>>>>> 2c5ebbcbb9204c5a18a518c60057da06662f3f94

    <div class="m-grid__item m-grid__item--middle">
      <div class="m--margin-top-20 m--visible-tablet-and-mobile"></div>
      <p *ngIf="eTrackerUserService?.showSpinner">loading...</p>
      <!-- <img *ngIf="eTrackerUserService?.showSpinner" src="/assets/images/spinner.gif" /> -->


    </div>


  </div>

</div>





<div class="m-portlet">
  <div class="m-portlet__body  m-portlet__body--no-padding">
    <agm-map *ngIf="eTrackerUserService.currentUser" [zoom]="selectedZoom" [usePanning]="true" [latitude]="eTrackerUserService.currentUser?.lat"
      [longitude]="eTrackerUserService.currentUser?.lng" (mapReady)="mapReady($event)">

      <agm-marker [latitude]="eTrackerUserService.currentUser?.lat" [longitude]="eTrackerUserService.currentUser?.lng"
        [iconUrl]="currentLocationMarker" [label]="{ color: 'black',
          fontFamily: 'Lato',
          fontSize: '30px',
          fontWeight: 'bold',
          text: eTrackerUserService?.currentUser.userid+''}">
        <agm-snazzy-info-window [panOnOpen]="false" [maxHeight]="300" [maxWidth]="100" [padding]="0" [showCloseButton]="false"
          [placement]="right" [closeWhenOthersOpen]="false">
          <ng-template>
            <div class="marker-info">
              <div class="info-header">
                <h1>Description</h1>
              </div>
              <div class="info-body">
                <p>Username: {{eTrackerUserService?.currentUser?.userid}}</p>
                <p>Event</p>
                <p>Time: {{getTime(eTrackerUserService?.currentUser?.timestamp.seconds)}}</p>
                <p>Date: {{getDate(eTrackerUserService?.currentUser?.timestamp.seconds)}}</p>
                <p>Customer</p>
              </div>
              <div class="info-footer">
              </div>
            </div>
          </ng-template>
        </agm-snazzy-info-window>
      </agm-marker>

      <agm-polyline *ngFor="let polyline of eTrackerUserService?.locationHistory;let i = index;" [strokeColor]="'red'"
        [geodesic]="true" [strokeOpacity]="0.7">
        <agm-polyline-point *ngFor="let point of eTrackerUserService?.locationHistory" [latitude]="point.lat"
          [longitude]="point.lng">
        </agm-polyline-point>
      </agm-polyline>

      <agm-marker *ngFor="let loc of eTrackerUserService?.productiveShops; let i = index" [latitude]="loc.lat"
        [longitude]="loc.lng" [iconUrl]="productiveShopMarker" [label]="{text: ''+(+i+1)}">
        <agm-info-window>
          <strong>InfoWindow content</strong>
        </agm-info-window>
      </agm-marker>

      <agm-marker *ngFor="let loc of eTrackerUserService.nonProductiveShops; let i = index" [latitude]="loc.lat"
        [longitude]="loc.lng" [iconUrl]="loc.pjp? nonProductiveShopMarker : nonProductiveShopMarkerOther" [label]="{text: ''+(+i+1)}">
        <agm-info-window>
          <strong>InfoWindow content</strong>
        </agm-info-window>
      </agm-marker>

      <agm-polyline *ngFor="let polyline of eTrackerUserService?.shopRouteTaken;let i = index;" [strokeColor]="'red'"
        [geodesic]="true" [strokeOpacity]="0.7">
        <agm-polyline-point *ngFor="let point of eTrackerUserService?.shopRouteTaken" [latitude]="point.lat"
          [longitude]="point.lng">
        </agm-polyline-point>
      </agm-polyline>

    </agm-map>

    <div style="width: auto; height: 54px;position: absolute; top: 250px; right: 2%; display: block; padding-top: 9px;z-index: 110;">
      <div class="btn-group-vertical" role="group" aria-label="Vertical button group">
        <button type="button" class="btn btn-success m-btn m-btn--custom m-btn--icon">
          <span>
            <i class="fa fa-map-marker"></i>
            <span>
              Cluster Events
            </span>
          </span>
        </button>
        <button type="button" class="btn btn-brand m-btn m-btn--custom m-btn--icon">
          <span>
            <i class="fa fa-map-marker"></i>
            <span>
              Mobility Events
            </span>
          </span>
        </button>
        <button (click)="showLiveTracking()" type="button" class="btn btn-warning m-btn m-btn--custom m-btn--icon">
          <span>
            <i class="fa fa-map-marker"></i>
            <span>
              Latest Location
            </span>
          </span>
        </button>
        <button (click)="showProductiveShops()" type="button" class="btn btn-accent m-btn m-btn--custom m-btn--icon">
          <span>
            <i class="fa fa-map-marker"></i>
            <span>
              Productive Shops
            </span>
          </span>
        </button>
        <button (click)="showNonProductiveShops()" type="button" class="btn btn-danger m-btn m-btn--custom m-btn--icon">
          <span>
            <i class="fa fa-map-marker"></i>
            <span>
              Non-Productive Shops
            </span>
          </span>
        </button>
        <br>
        <button (click)="showRouteTaken()" type="button" class="btn btn-danger m-btn m-btn--custom m-btn--icon">
          <span>
            <i class="fa fa-map-marker"></i>
            <span>
              Route Taken
            </span>
          </span>
        </button>
        <button (click)="showLiveTrackingSimulation()" type="button" class="btn btn-accent m-btn m-btn--custom m-btn--icon">
          <span>
            <i class="fa fa-map-marker"></i>
            <span>
              Latest Location (Simulation)
            </span>
          </span>
        </button>

      </div>
    </div>
  </div>


</div>



<div *ngIf="liveTracking" class="live-tracking-panel">
  <div class="live-tracking-overlay"></div>
  <div class="live-tracking-map-view">
    <button (click)="liveTracking = false">End Live Tracking</button>
    <agm-map *ngIf="eTrackerUserService.currentUser" [zoom]="selectedZoom" [usePanning]="true" [latitude]="eTrackerUserService.currentUser?.lat"
      [longitude]="eTrackerUserService.currentUser?.lng" (mapReady)="mapReady($event)">

      <agm-marker [latitude]="eTrackerUserService.currentUser?.lat" [longitude]="eTrackerUserService.currentUser?.lng"
        [iconUrl]="currentLocationMarker" [label]="{text:'JOhn Doe', color: 'black', fontSize: '20px', fontWeight: 'bold'}">
        <agm-snazzy-info-window [panOnOpen]="false" [maxHeight]="300" [maxWidth]="100" [padding]="0" [showCloseButton]="false"
          [placement]="right" [closeWhenOthersOpen]="false">
          <ng-template>
            <div class="marker-info">
              <div class="info-header">
                <h1>Description</h1>
              </div>
              <div class="info-body">
                <p>Username: {{eTrackerUserService?.currentUser?.userid}}</p>
                <p>Event</p>
                <p>Time: {{getTime(eTrackerUserService?.currentUser?.timestamp.seconds)}}</p>
                <p>Date: {{getDate(eTrackerUserService?.currentUser?.timestamp.seconds)}}</p>
                <p>Customer</p>
              </div>
              <div class="info-footer">
              </div>
            </div>
          </ng-template>
        </agm-snazzy-info-window>
      </agm-marker>

      <agm-polyline *ngFor="let polyline of sampleTracking;let i = index;" [strokeColor]="'red'" [geodesic]="true"
        [strokeOpacity]="0.7">
        <agm-polyline-point *ngFor="let point of sampleTracking" [latitude]="point?.lat" [longitude]="point?.lng">
        </agm-polyline-point>
      </agm-polyline>

    </agm-map>

  </div>
</div>